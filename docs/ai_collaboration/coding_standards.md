# ç¼–ç è§„èŒƒ (Coding Standards)

## ğŸ¯ æ ¸å¿ƒåŸåˆ™

### 1. æ³¨é‡Šé€šä¿—æ˜“æ‡‚
- å†™æ³¨é‡Šæ—¶æƒ³è±¡ä½ åœ¨ç»™ä¸€ä¸ªä¸äº†è§£é¡¹ç›®çš„æœ‹å‹è§£é‡Š
- è§£é‡Š"ä¸ºä»€ä¹ˆè¿™æ ·åš"ï¼Œè€Œä¸æ˜¯"ä»£ç åšäº†ä»€ä¹ˆ"
- ä¸­æ–‡æ³¨é‡Šä¼˜å…ˆï¼ˆä¸ªäººé¡¹ç›®ï¼Œæ–¹ä¾¿è‡ªå·±é˜…è¯»ï¼‰

### 2. æ–‡ä»¶å¤´éƒ¨å¿…é¡»æœ‰æ¨¡å—è¯´æ˜
æ¯ä¸ª `.py` æ–‡ä»¶å¼€å¤´å¿…é¡»åŒ…å«ï¼š
```python
"""
æ–‡ä»¶å: xxx.py
åŠŸèƒ½: ç®€è¦æè¿°è¿™ä¸ªæ–‡ä»¶åšä»€ä¹ˆ
åœ¨ç³»ç»Ÿä¸­çš„è§’è‰²: è¿™ä¸ªæ¨¡å—åœ¨æ•´ä½“æ¶æ„ä¸­è´Ÿè´£ä»€ä¹ˆ

ä¾‹å¦‚:
- è¢«è°è°ƒç”¨ï¼Ÿ
- è°ƒç”¨äº†å“ªäº›å…¶ä»–æ¨¡å—ï¼Ÿ
- æ ¸å¿ƒé€»è¾‘æ˜¯ä»€ä¹ˆï¼Ÿ
"""
```

**ç¤ºä¾‹**ï¼š
```python
"""
æ–‡ä»¶å: memory_store.py
åŠŸèƒ½: ç®¡ç†ç”¨æˆ·çš„é•¿æœŸè®°å¿†å­˜å‚¨å’Œæ£€ç´¢
åœ¨ç³»ç»Ÿä¸­çš„è§’è‰²:
    - è¢« Agent è°ƒç”¨ï¼Œç”¨äºå­˜å–ç”¨æˆ·ä¿¡æ¯å’Œå¯¹è¯å†å²
    - ä¾èµ– vector_store.py è¿›è¡Œè¯­ä¹‰æ£€ç´¢
    - ä¾èµ– sql_store.py è¿›è¡Œç»“æ„åŒ–æ•°æ®å­˜å‚¨

æ ¸å¿ƒé€»è¾‘:
    1. æ”¶åˆ° Agent çš„å­˜å‚¨è¯·æ±‚ -> åˆ¤æ–­æ•°æ®ç±»å‹
    2. ç»“æ„åŒ–æ•°æ® (å¦‚ç”¨æˆ·çŠ¶æ€) -> å†™å…¥ SQL
    3. éç»“æ„åŒ–æ•°æ® (å¦‚å¯¹è¯æ‘˜è¦) -> å‘é‡åŒ–åå†™å…¥å‘é‡åº“
    4. æ£€ç´¢æ—¶åŒæ—¶æŸ¥è¯¢ä¸¤ä¸ªåº“ï¼Œåˆå¹¶ç»“æœè¿”å›
"""
```

### 3. å•ä¸€èŒè´£ï¼Œè§£è€¦è®¾è®¡
- **ä¸€ä¸ªæ–‡ä»¶åªåšä¸€ä»¶äº‹**
- æ–‡ä»¶ä¹‹é—´é€šè¿‡æ¸…æ™°çš„æ¥å£é€šä¿¡ï¼Œä¸ç›´æ¥è®¿é—®å½¼æ­¤çš„å†…éƒ¨å®ç°
- å¦‚æœä¸€ä¸ªæ–‡ä»¶è¶…è¿‡ 300 è¡Œï¼Œè€ƒè™‘æ‹†åˆ†

---

## ğŸ Python è§„èŒƒ

### ç‰ˆæœ¬ä¸ç¯å¢ƒ
- Python 3.11+
- ä½¿ç”¨ `uv` ç®¡ç†ä¾èµ–ï¼ˆæ›´å¿«æ›´ç°ä»£ï¼‰
- è™šæ‹Ÿç¯å¢ƒï¼š`.venv/`

### å‘½åè§„åˆ™
| ç±»å‹       | è§„åˆ™          | ç¤ºä¾‹                         |
| :--------- | :------------ | :--------------------------- |
| å˜é‡/å‡½æ•°  | `snake_case`  | `user_message`, `send_msg`   |
| ç±»         | `PascalCase`  | `AgentConfig`, `MemoryStore` |
| å¸¸é‡       | `UPPER_SNAKE` | `MAX_TOKENS`, `API_KEY`      |
| ç§æœ‰æˆå‘˜   | `_prefix`     | `_internal_state`            |

### ç±»å‹æ³¨è§£
æ‰€æœ‰å‡½æ•°å¿…é¡»æœ‰ç±»å‹æ³¨è§£ï¼Œè®©ä»£ç è‡ªè§£é‡Šï¼š
```python
# âœ… æ­£ç¡®
def send_message(user_id: str, content: str) -> MessageResponse:
    ...

# âŒ é”™è¯¯
def send_message(user_id, content):
    ...
```

### æ–‡æ¡£å­—ç¬¦ä¸² (Google é£æ ¼)
```python
def process_message(message: str, agent_id: str) -> AgentResponse:
    """å¤„ç†ç”¨æˆ·æ¶ˆæ¯å¹¶è¿”å› Agent å“åº”ã€‚

    ç®€å•è¯´å°±æ˜¯ï¼šæŠŠç”¨æˆ·çš„è¯è½¬ç»™ AIï¼Œæ‹¿åˆ°å›å¤åè¿”å›ã€‚
    è¿™æ˜¯æ•´ä¸ªå¯¹è¯æµç¨‹çš„æ ¸å¿ƒå…¥å£ã€‚

    Args:
        message: ç”¨æˆ·è¾“å…¥çš„æ¶ˆæ¯ã€‚
        agent_id: è¦è°ƒç”¨å“ªä¸ª Agentã€‚

    Returns:
        AgentResponse: åŒ…å« AI çš„å›å¤å’Œä¸€äº›å…ƒæ•°æ®ã€‚

    Raises:
        AgentNotFoundError: agent_id ä¸å­˜åœ¨æ—¶æŠ›å‡ºã€‚
    """
    ...
```

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
src/
â”œâ”€â”€ agents/           # Agent ç›¸å…³ (æ¯ä¸ª Agent ä¸€ä¸ªæ–‡ä»¶)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ base.py       # Agent åŸºç±»ï¼Œå®šä¹‰å…¬å…±æ¥å£
â”‚   â””â”€â”€ companion.py  # é™ªä¼´ Agent çš„å…·ä½“å®ç°
â”œâ”€â”€ memory/           # è®°å¿†ç³»ç»Ÿ (å­˜å‚¨å’Œæ£€ç´¢åˆ†å¼€)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â”œâ”€â”€ vector_store.py  # å‘é‡å­˜å‚¨
â”‚   â””â”€â”€ sql_store.py     # SQL å­˜å‚¨
â”œâ”€â”€ api/              # FastAPI è·¯ç”± (åªè´Ÿè´£æ¥æ”¶è¯·æ±‚ï¼Œä¸å«ä¸šåŠ¡é€»è¾‘)
â”‚   â”œâ”€â”€ __init__.py
â”‚   â””â”€â”€ routes/
â”œâ”€â”€ scheduler/        # å®šæ—¶ä»»åŠ¡ (ä¸»åŠ¨æ¶ˆæ¯è°ƒåº¦)
â”œâ”€â”€ models/           # æ•°æ®æ¨¡å‹ (Pydanticï¼Œçº¯æ•°æ®å®šä¹‰)
â”œâ”€â”€ services/         # ä¸šåŠ¡é€»è¾‘å±‚ (ç»„è£…å„æ¨¡å—)
â””â”€â”€ utils/            # å·¥å…·å‡½æ•° (é€šç”¨çš„ã€ä¸ä¸šåŠ¡æ— å…³çš„)
```

---

## âœ… æµ‹è¯•è§„èŒƒ

### æ–‡ä»¶ç»“æ„
- æµ‹è¯•æ–‡ä»¶ï¼š`test_<æ¨¡å—å>.py`
- æ”¾åœ¨ `tests/` ç›®å½•ï¼Œé•œåƒ `src/` ç»“æ„

### æµ‹è¯•è¦æ±‚
- æ¯ä¸ªåŠŸèƒ½æ¨¡å—å¿…é¡»æœ‰æµ‹è¯•
- ä½¿ç”¨ `pytest`
- æäº¤å‰è¿è¡Œï¼š`pytest tests/`

```python
# tests/test_memory.py
def test_store_user_status():
    """æµ‹è¯•ï¼šå­˜ä¸€ä¸ªçŠ¶æ€ï¼Œèƒ½æŸ¥å‡ºæ¥ã€‚"""
    store = MemoryStore()
    store.save_status("user_001", {"type": "wake_up", "time": "08:00"})
    result = store.get_latest_status("user_001")
    assert result["type"] == "wake_up"
```

---

## ğŸ”§ æ ¼å¼åŒ–å·¥å…·

### pyproject.toml é…ç½®
```toml
[tool.black]
line-length = 88

[tool.isort]
profile = "black"

[tool.ruff]
line-length = 88
select = ["E", "F", "I"]
```

### æäº¤å‰æ£€æŸ¥æµç¨‹
```bash
# 1. æ ¼å¼åŒ–ä»£ç 
black src/ tests/
isort src/ tests/

# 2. é™æ€æ£€æŸ¥
ruff check src/

# 3. è¿è¡Œæµ‹è¯•
pytest tests/
```
